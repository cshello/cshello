
# 4.异常捕获并打印堆栈

## 案例1
- main.c

```C
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <signal.h>
#include <execinfo.h>

#define _GNU_SOURCE
#include <string.h>

void dump(void) {
    int nptrs = 0;
    void *buf[128];
    char **strs;

    nptrs = backtrace(buf, 128);
    printf("backtrace() returned %d addresses. \n", nptrs);

    strs = backtrace_symbols(buf, nptrs);
    if (strs == NULL) {
        fprintf(stderr, "strs is NULL. \n");
        return;
    }
    for (int i = 0; i < nptrs; i++) {
        printf("  [%02d] %s\n", i, strs[i]);
    }
    free(strs);
    
}

void handler(int signo) {
    printf("\n ==========>> catch signal %d (%s) <<============\n", signo, (char *)strsignal(signo));
    // printf("\n ==========>> catch signal %d (%s) <<============\n", signo, "123");
    dump();
    exit(EXIT_FAILURE);
}


int main(int argc, char *argv[]) {
    printf("Hello, file: %s\n", __FILE__);
    
    signal(SIGFPE, handler);
    signal(SIGSEGV, handler);
    
    int a = 0;
    int c = 2 / a;
    return 0;
}
```

- OUTPUT
```txt
Hello, file: main.c

 ==========>> catch signal 8 (Floating point exception) <<============
backtrace() returned 6 addresses. 
  [00] ./main(+0x1285) [0x5593bb41e285]
  [01] ./main(+0x13a1) [0x5593bb41e3a1]
  [02] /lib/x86_64-linux-gnu/libc.so.6(+0x43090) [0x7fe7c9794090]
  [03] ./main(+0x1405) [0x5593bb41e405]
  [04] /lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf3) [0x7fe7c9775083]
  [05] ./main(+0x118e) [0x5593bb41e18e]
```


